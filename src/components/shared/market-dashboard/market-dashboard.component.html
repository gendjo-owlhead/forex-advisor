
<div class="grid grid-cols-1 lg:grid-cols-5 gap-8">
  
  <!-- Left Column: Controls & Summaries -->
  <div class="lg:col-span-2 flex flex-col gap-8">
    <section class="bg-gray-800/50 rounded-lg p-6 shadow-2xl border border-gray-700">
      <app-controls 
          [initialPair]="initialPair()" 
          [availablePairs]="availablePairs()"
          (pairSelected)="handlePairSelection($event)"
          (timeframeSelected)="handleTimeframeSelection($event)"
          (analyze)="handleAnalysisRequest($event)">
      </app-controls>
    </section>

    <!-- Strategy Selector -->
    <section class="bg-gray-800/50 rounded-lg p-6 shadow-2xl border border-gray-700">
      <h3 class="text-xl font-semibold mb-4 text-sky-300">ðŸ“Š Backtesting Strategy</h3>
      <div class="flex flex-col gap-2">
        <label for="strategy-select" class="text-sm text-gray-300">Select Strategy:</label>
        <select 
          id="strategy-select"
          [value]="selectedStrategy()"
          (change)="handleStrategySelection($any($event.target).value)"
          class="bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-sky-500 focus:outline-none">
          @for (strategy of availableStrategies; track strategy.id) {
            <option [value]="strategy.id">{{strategy.name}}</option>
          }
        </select>
        <p class="text-xs text-gray-400 mt-2">Change strategy to see different backtesting results</p>
      </div>
    </section>

    <section class="bg-gray-800/50 rounded-lg p-6 shadow-2xl border border-gray-700">
        <app-conclusion [conclusion]="analysisResult()?.conclusion"></app-conclusion>
    </section>
    
    <section class="bg-gray-800/50 rounded-lg p-6 shadow-2xl border border-gray-700">
        <app-performance
            [winRate]="realWinRate()"
            [totalTrades]="realTotalTrades()"
            [profitFactor]="realProfitFactor()"
            [candlesUsed]="candlesUsed()">
        </app-performance>
    </section>

    <section class="bg-gray-800/50 rounded-lg p-6 shadow-2xl border border-gray-700">
        <app-trade-log 
            [trades]="realTrades()"
            [strategyId]="selectedStrategy()">
        </app-trade-log>
    </section>

    <section class="bg-gray-800/50 rounded-lg p-6 shadow-2xl border border-gray-700">
        <app-sentiment-dashboard [conclusion]="analysisResult()?.conclusion"></app-sentiment-dashboard>
    </section>

     <section class="bg-gray-800/50 rounded-lg p-6 shadow-2xl border border-gray-700">
        <app-alerts [currentSignal]="currentSignal()"></app-alerts>
    </section>
  </div>

  <!-- Right Column: Chart & Detailed Analysis -->
  <div class="lg:col-span-3 flex flex-col gap-8">
    <section class="bg-gray-800/50 rounded-lg p-6 shadow-2xl border border-gray-700">
      <h2 class="text-2xl font-semibold mb-4 text-sky-300">Price Chart: {{ selectedPair() }} ({{ selectedTimeframe() }})</h2>
      <app-chart [pair]="selectedPair()" [timeframe]="selectedTimeframe()" [marketType]="marketType()"></app-chart>
    </section>
    
    <section class="bg-gray-800/50 rounded-lg p-6 shadow-2xl border border-gray-700 min-h-[400px]">
       <h2 class="text-2xl font-semibold mb-4 text-sky-300">AI Narrative Analysis</h2>
       <app-analysis 
            [isLoading]="isLoading()" 
            [analysis]="analysisResult()" 
            [error]="error()"
            [conclusion]="analysisResult()?.conclusion">
       </app-analysis>
    </section>
  </div>
</div>
